import( "../build/input/extracted/field/script/field.bf" );
import( "../ModMenu.flow" );


void order_party_hook()
{
	int dungeon = FLD_FUNCTION_0002();
	int time = GET_TIME_OF_DAY();
	int field = FLD_FUNCTION_0022();
	
	//Show text?
	FUNCTION_0023( 0, 3 );
	
	if (dungeon > 0 || ((time >= 3 && time <= 5) && ((field >= 6 && field <= 11) || (field == 17 || field == 18))))
	{
		//Prompt user to choose between mod menu or quick travel if in an appropriate area
		int selection = FUNCTION_0025( Square_Menu_Text, Square_Menu, 0);
		switch (selection)
		{
			case 0:
				if ( FLD_FUNCTION_0002() > 0 )
				{
					dungeon_order();
				}
				else
				{
					field_order();
				}
				break;
			case 1:
				FUNCTION_007D();
				break;
			case 2:
				ModMenuDisplay();
				break;
			case 3:
				break;
		}
	}
	else
	{
		//Show mod menu by default if not in an area with quick travel options
		ModMenuDisplay();
	}
}

void field_order_hook()
{
	if ( FLD_FUNCTION_0022() == 6 )
	{
		//Show expanded school quicktravel menu
		int school = FUNCTION_0025( School_Text, School, 0 );
		if ( school != 8 )
		{
			OUTRO( 1, 5 );
			OUTRO_SYNC();
			switch (school)
			{
				case 0:
					CALL_FIELD( 6, 1, 1, 0 );
					break;
				case 1:
					CALL_FIELD( 6, 2, 1, 0 );
					break;
				case 2:
					CALL_FIELD( 6, 3, 1, 0 );
					break;
				case 3:
					CALL_FIELD( 6, 4, 1, 0 );
					break;
				case 4:
					CALL_FIELD( 6, 5, 1, 0 );
					break;
				case 5:
					CALL_FIELD( 6, 6, 1, 0 );
					break;
				case 6:
					CALL_FIELD( 6, 14, 1, 0 );
					break;
				case 7:
					TOWN_MAP( 0 );
					break;
				case 8:
					break;
			}
		}
	}
	else if (FLD_FUNCTION_0022() != 7)
	{
		//Show town quicktravel menu if not at home or school
		int street = FUNCTION_0025( Street_Text, Street, 0 );
		if ( street != 8 )
		{
			OUTRO( 1, 5 );
			OUTRO_SYNC();
			switch (street)
			{
				case 0:
					CALL_FIELD( 8, 1, 1, 0 );
					break;
				case 1:
					CALL_FIELD( 8, 2, 1, 0 );
					break;
				case 2:
					CALL_FIELD( 8, 9, 1, 0 );
					break;
				case 3:
					CALL_FIELD( 10, 1, 1, 0 );
					break;
				case 4:
					CALL_FIELD( 10, 2, 1, 0 );
					break;
				case 5:
					CALL_FIELD( 7, 1, 1, 0 );
					break;
				case 6:
					CALL_FIELD( 9, 4, 1, 0 );
					break;
				case 7:
					TOWN_MAP( 0 );
					break;
				case 8:
					break;
			}
		}
	}
}