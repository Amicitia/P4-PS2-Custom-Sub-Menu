
// 
// FlowScript decompiled by AtlusScriptLib by TGE (2017)
// In the unfortunate case of any bugs, please report them back to me.
// 


// 
// Imports
// 

import( "dungeon.bf.msg" );

// 
// Script-level variable definitions
// 

global( 9 ) int gVar9;
int sVar4;
int sVar5;
int sVar6;
int sVar7;
int sVar8;
int sVar10;
int sVar3;
int sVar2;
int sVar1;
int sVar0;

// 
// Procedure declarations
// 

void dng_go_stair()
{
    goto_stair();
}


void dng_back_stair()
{
    backto_stair();
}


void dng_tbox()
{
    int var11 = GET_FLOOR_ID();
    int var12 = FLD_FUNCTION_0026();
    get_box_item_id();
    
    if ( var11 == 10 && sVar3 == 11262 && BIT_CHK( 0 + 0x0400 + 0x0800 + 619 ) == 0 )
    {
        box_open_010_1();
    }
    else if ( var11 == 10 && sVar3 == 11261 && BIT_CHK( 0 + 0x0400 + 0x0800 + 620 ) == 0 )
    {
        box_open_010_2();
    }
    else if ( var11 == 23 && sVar3 == 11262 && BIT_CHK( 0 + 0x0400 + 0x0800 + 644 ) == 0 )
    {
        box_open_023_1();
    }
    else if ( var11 == 23 && sVar3 == 11260 && BIT_CHK( 0 + 0x0400 + 0x0800 + 645 ) == 0 )
    {
        box_open_023_2();
    }
    else if ( var11 == 67 && sVar3 == 11261 && BIT_CHK( 0 + 0x0400 + 0x0800 + 708 ) == 0 )
    {
        box_open_067();
    }
    else if ( var11 == 84 && sVar3 == 11261 && BIT_CHK( 0 + 0x0400 + 0x0800 + 738 ) == 0 )
    {
        box_open_084();
    }
    else if ( var11 == 86 && sVar3 == 11261 && BIT_CHK( 0 + 0x0400 + 0x0800 + 737 ) == 0 )
    {
        box_open_086();
    }
    else if ( var11 == 161 && sVar3 == 11262 && BIT_CHK( 0 + 0x0400 + 0x0800 + 848 ) == 0 )
    {
        box_open_161_1();
    }
    else if ( var11 == 161 && sVar3 == 11261 && BIT_CHK( 0 + 0x0400 + 0x0800 + 849 ) == 0 )
    {
        box_open_161_2();
    }
    else if ( var11 == 161 && sVar3 == 11260 && BIT_CHK( 0 + 0x0400 + 0x0800 + 850 ) == 0 )
    {
        box_open_161_3();
    }
    else if ( var11 == 161 && sVar3 == 11259 && BIT_CHK( 0 + 0x0400 + 0x0800 + 851 ) == 0 )
    {
        box_open_161_4();
    }
    else if ( var11 > 160 && var12 == 8 || var12 == 9 )
    {
        tomb_enc_box();
    }
    else if ( var12 == 10 )
    {
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 8 ) == 0 && BIT_CHK( 0 + 0x0400 + 0x0800 + 46 ) == 1 )
        {
            death_box();
        }
        else 
        {
            encount_box();
        }

    }
    else if ( var12 == 1 )
    {
        rank_box();
    }
    else 
    {
        no_rank_box();
    }

}


void dng_door()
{
    int var13 = GET_FLOOR_ID();
    int var14 = FLD_FUNCTION_0025();
    int var15 = FLD_FUNCTION_0027();
    int var16 = FLD_FUNCTION_0014();
    sVar6 = 0;
    FLD_FUNCTION_002D( 5 );
    
    if ( var13 == 10 )
    {
        castle_05F_door();
    }
    else if ( var13 == 23 )
    {
        sauna_03F_door();
    }
    else if ( var13 == 27 )
    {
        sauna_07F_door();
    }
    else if ( var13 == 43 )
    {
        playhouse_03F_door();
    }
    else if ( var13 == 47 )
    {
        playhouse_07F_door();
    }
    else if ( var13 == 67 )
    {
        gameworld_07F_door();
    }
    else if ( var13 == 84 )
    {
        base_04F_door();
    }
    else if ( var13 == 86 )
    {
        base_06F_door();
    }
    else if ( var13 == 104 )
    {
        heaven_04F_door();
    }
    else if ( var13 == 107 )
    {
        heaven_07F_door();
    }
    else if ( var13 == 122 )
    {
        city_02F_door();
    }
    else if ( var13 == 125 )
    {
        city_05F_door();
    }
    else if ( var13 == 0x80 )
    {
        city_08F_door();
    }
    else if ( var13 == 143 )
    {
        last_03F_door();
    }
    else if ( var13 == 146 )
    {
        last_06F_door();
    }
    else if ( var13 == 159 )
    {
        first_door();
    }
    else if ( var13 == 161 )
    {
        tomb_01F_door_enc();
    }
    else if ( var13 == 164 )
    {
        tomb_04F_door_enc();
    }
    else if ( var13 == 167 )
    {
        tomb_07F_door_enc();
    }

    
    if ( sVar6 == 0 )
    {
        
        if ( var13 > 5 && var13 <= 20 )
        {
            PLAY_SOUNDEFFECT( 708 );
            NS_WAIT( 1 );
        }
        else if ( var13 > 20 && var13 <= 40 )
        {
            PLAY_SOUNDEFFECT( 709 );
            NS_WAIT( 1 );
        }
        else if ( var13 > 40 && var13 <= 60 )
        {
            PLAY_SOUNDEFFECT( 711 );
            NS_WAIT( 3 );
        }
        else if ( var13 > 60 && var13 <= 80 )
        {
            PLAY_SOUNDEFFECT( 712 );
            NS_WAIT( 2 );
        }
        else if ( var13 > 80 && var13 <= 100 )
        {
            PLAY_SOUNDEFFECT( 710 );
            NS_WAIT( 2 );
        }
        else if ( var13 > 100 && var13 <= 120 )
        {
            PLAY_SOUNDEFFECT( 713 );
        }
        else if ( var13 > 120 && var13 <= 140 )
        {
            PLAY_SOUNDEFFECT( 714 );
            NS_WAIT( 2 );
        }
        else if ( var13 > 140 && var13 <= 160 )
        {
            PLAY_SOUNDEFFECT( 715 );
            NS_WAIT( 1 );
        }
        else if ( var13 > 160 )
        {
            PLAY_SOUNDEFFECT( 741 );
            NS_WAIT( 1 );
        }

        
        if ( var13 > 160 )
        {
            FLD_FUNCTION_0043( var16 );
        }

        
        if ( var13 > 60 && var13 <= 80 )
        {
            FLD_FUNCTION_0008( var16, var14, 0, 0, 0.90f );
        }
        else 
        {
            FLD_FUNCTION_0008( var16, var14, 0, 0, 1 );
        }

        FLD_FUNCTION_0009( var16 );
        FLD_FUNCTION_0010( var15, 0 );
        FLD_FUNCTION_0015();
        find_something();
    }

}


void dng_decease_2()
{
}


void dng_escape()
{
    int var17 = GET_FLOOR_ID();
    int var18 = GET_FLOOR_ID();
    
    if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 92 ) == 1 && BIT_CHK( 0 + 0x0400 + 0x0800 + 93 ) == 0 )
    {
        NS_WAIT( 10 );
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( ESCAPE_BAN );
        CLOSE_MSG_WIN();
    }
    else if ( GET_CNT( 38 ) == 13 )
    {
        SET_CNT( 38, 14 );
        BIT_OFF( 0 + 0x0400 + 0x0800 + 46 );
        BIT_OFF( 0 + 0x0400 + 0x0800 + 47 );
    }

    
    if ( FLD_FUNCTION_0036() == 1 && FLD_FUNCTION_0037() == 0 )
    {
        var18 = var18 + 1;
    }

    
    if ( var17 >= 5 && var17 < 20 )
    {
        SET_CNT( 23, var18 );
    }
    else if ( var17 >= 20 && var17 < 40 )
    {
        SET_CNT( 24, var18 );
    }
    else if ( var17 >= 40 && var17 < 60 )
    {
        SET_CNT( 25, var18 );
    }
    else if ( var17 >= 60 && var17 < 80 )
    {
        SET_CNT( 26, var18 );
    }
    else if ( var17 >= 80 && var17 < 100 )
    {
        SET_CNT( 27, var18 );
    }
    else if ( var17 >= 100 && var17 < 120 )
    {
        SET_CNT( 28, var18 );
    }
    else if ( var17 >= 120 && var17 < 140 )
    {
        
        if ( var17 != 121 && var17 != 122 && var17 != 129 )
        {
            SET_CNT( 29, var18 );
        }

    }
    else if ( var17 >= 140 && var17 < 160 )
    {
        SET_CNT( 30, var18 );
    }
    else if ( var17 >= 160 && var17 < 180 )
    {
        SET_CNT( 37, var17 );
    }

    TRAESTO_VISUAL();
    
    if ( var17 > 5 && var17 < 20 )
    {
        CALL_DUNGEON( 5, 1 );
    }
    else if ( var17 > 20 && var17 < 40 )
    {
        CALL_DUNGEON( 20, 1 );
    }
    else if ( var17 > 40 && var17 < 60 )
    {
        CALL_DUNGEON( 40, 1 );
    }
    else if ( var17 > 60 && var17 < 80 )
    {
        CALL_DUNGEON( 60, 1 );
    }
    else if ( var17 > 80 && var17 < 100 )
    {
        CALL_DUNGEON( 80, 1 );
    }
    else if ( var17 > 100 && var17 < 120 )
    {
        CALL_DUNGEON( 100, 1 );
    }
    else if ( var17 > 120 && var17 < 140 )
    {
        CALL_DUNGEON( 120, 1 );
    }
    else if ( var17 > 140 && var17 < 160 )
    {
        CALL_DUNGEON( 140, 1 );
    }
    else if ( var17 > 160 && var17 < 180 )
    {
        CALL_DUNGEON( 160, 1 );
    }

}


void dng_afterBattle()
{
    
    if ( gVar9 == 0 )
    {
        encount_trap();
    }

    int var19 = 0;
    
    if ( GET_FLOOR_ID() == 161 && BIT_CHK( 0 + 0x0400 + 0x0800 + 834 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 834 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        var19 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_1F_DOOR_INFO );
        FUNCTION_005D( var19 );
        CLOSE_MSG_WIN();
        NS_WAIT( 10 );
        var19 = FUNCTION_005C( 280, -40, 5, 33 );
        OPEN_MSG_WIN();
        
        if ( GET_PARTY_MEMBER_ID( 0 ) != 0 )
        {
            MSG( SP_ZERO_HELP_ALL );
        }
        else 
        {
            MSG( SP_ZERO_HELP_PLAYER );
        }

        MSG( SP_ZERO_HELP_COM );
        CLOSE_MSG_WIN();
        FUNCTION_005D( var19 );
    }
    else if ( GET_FLOOR_ID() == 161 && BIT_CHK( 0 + 0x0400 + 0x0800 + 852 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 852 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        var19 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_1F_END_1 );
        FUNCTION_005D( var19 );
        CLOSE_MSG_WIN();
    }
    else if ( GET_FLOOR_ID() == 161 && BIT_CHK( 0 + 0x0400 + 0x0800 + 853 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 853 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        var19 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_1F_END_2 );
        FUNCTION_005D( var19 );
        CLOSE_MSG_WIN();
    }
    else if ( GET_FLOOR_ID() == 161 && BIT_CHK( 0 + 0x0400 + 0x0800 + 854 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 854 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        var19 = FUNCTION_005C( 280, -40, 5, 33 );
        MSG( TOMB_ENC_1F_END_3_1 );
        FUNCTION_005D( var19 );
        var19 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_1F_END_3_2 );
        FUNCTION_005D( var19 );
        CLOSE_MSG_WIN();
    }

}


void encount_trap()
{
    
    if ( GET_FLOOR_ID() == 125 && BIT_CHK( 0 + 0x0400 + 0x0800 + 801 ) == 0 )
    {
        gVar9 = 0;
        BIT_ON( 0 + 0x0400 + 0x0800 + 37 );
        BIT_ON( 0 + 0x0400 + 0x0800 + 808 );
        BIT_ON( 0 + 0x0400 + 0x0800 + 806 );
        NS_WAIT( 30 );
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( ENC_GIMMIC_MISS );
        CLOSE_MSG_WIN();
        PLAY_SOUNDEFFECT( 705 );
        FADE( 1, 30 );
        FUNCTION_0024( 255, 255, 255 );
        FADE_SYNC();
        CALL_DUNGEON( 120, 1 );
    }

}


void find_something()
{
    int var25 = 1000;
    int var24 = RNG( var25 );
    int var21 = 0;
    int var22 = 0;
    int var26 = 0;
    int var27 = 0;
    int var28 = 0;
    int var29 = 0;
    int var30 = 0;
    int var31 = 0;
    int var20 = 0;
    int var23 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 && BIT_CHK( 0 + 0x0400 + 0x0800 + 39 ) == 0 && CHECK_TIME_SPAN( 4, 18, 4, 29 ) == 1 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 39 );
        OPEN_MSG_WIN();
        var20 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( HELP_STAIR_KUMA );
        FUNCTION_005D( var20 );
        CLOSE_MSG_WIN();
        HELP_MSG( 15 );
        return;
    }
    else if ( BIT_CHK( 0 + 52 ) == 0 )
    {
        get_msg_kuma();
    }
    else 
    {
        get_msg_rise();
    }

    
    if ( sVar4 != 0 )
    {
        var22 = var22 + 1;
        var26 = sVar4;
    }

    _97:
    
    if ( var21 < 3 )
    {
        var23 = GET_PARTY_MEMBER_ID( var21 );
        
        if ( var23 != 0 )
        {
            
            if ( var23 == 2 )
            {
                get_msg_yosuke();
            }
            else if ( var23 == 3 )
            {
                get_msg_chie();
            }
            else if ( var23 == 4 )
            {
                get_msg_yukiko();
            }
            else if ( var23 == 6 )
            {
                get_msg_kanji();
            }
            else if ( var23 == 8 )
            {
                get_msg_kuma();
            }
            else if ( var23 == 7 )
            {
                get_msg_naoto();
            }

            
            if ( sVar4 != 0 )
            {
                var22 = var22 + 1;
                
                if ( var26 == 0 )
                {
                    var26 = sVar4;
                }
                else if ( var27 == 0 )
                {
                    var27 = sVar4;
                }
                else if ( var28 == 0 )
                {
                    var28 = sVar4;
                }
                else if ( var29 == 0 )
                {
                    var29 = sVar4;
                }

            }

        }

        var21 = var21 + 1;
        goto _97;
    }

    
    if ( var22 > 0 )
    {
        
        if ( var24 <= var25 * 1 / var22 )
        {
            var30 = var26;
        }
        else if ( var24 <= var25 * 2 / var22 )
        {
            var30 = var27;
        }
        else if ( var24 <= var25 * 3 / var22 )
        {
            var30 = var28;
        }
        else 
        {
            var30 = var29;
        }

        
        if ( var30 >= 0x10 && var30 <= 38 )
        {
            var31 = 2;
        }
        else if ( var30 >= 39 && var30 <= 61 )
        {
            var31 = 3;
        }
        else if ( var30 >= 62 && var30 <= 84 )
        {
            var31 = 4;
        }
        else if ( var30 >= 85 && var30 <= 107 )
        {
            var31 = 6;
        }
        else if ( var30 >= 108 && var30 <= 130 )
        {
            var31 = 8;
        }
        else if ( var30 >= 131 && var30 <= 153 )
        {
            var31 = 5;
        }
        else if ( var30 >= 154 && var30 <= 176 )
        {
            var31 = 7;
        }

        FLD_FUNCTION_002A( var31, var30 );
    }

}


void get_npc()
{
    sVar5 = 0;
    int var32 = RNG( 900 );
    int var33 = 1;
    int var34 = 0;
    _131:
    
    if ( var33 <= 8 )
    {
        
        if ( GET_FLOOR_ID() == GET_CNT( var33 ) )
        {
            var34 = var34 + 1;
        }

        var33 = var33 + 1;
        goto _131;
    }

    
    if ( var34 == 2 )
    {
        
        if ( GET_FLOOR_ID() == GET_CNT( 8 ) )
        {
            
            if ( var32 <= 300 )
            {
                sVar5 = 8;
            }
            else if ( var32 <= 600 )
            {
                sVar5 = 1;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 7 ) )
            {
                sVar5 = 7;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
            {
                sVar5 = 5;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
            {
                sVar5 = 2;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
            {
                sVar5 = 3;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
            {
                sVar5 = 6;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
            {
                sVar5 = 4;
            }

        }
        else if ( GET_FLOOR_ID() == GET_CNT( 7 ) )
        {
            
            if ( var32 < 300 )
            {
                sVar5 = 7;
            }
            else if ( var32 < 600 )
            {
                sVar5 = 1;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
            {
                sVar5 = 2;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
            {
                sVar5 = 3;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
            {
                sVar5 = 4;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
            {
                sVar5 = 5;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
            {
                sVar5 = 6;
            }

        }
        else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
        {
            
            if ( var32 < 300 )
            {
                sVar5 = 3;
            }
            else if ( var32 <= 600 )
            {
                sVar5 = 1;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
            {
                sVar5 = 4;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
            {
                sVar5 = 6;
            }

        }
        else if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
        {
            
            if ( var32 < 300 )
            {
                sVar5 = 2;
            }
            else if ( var32 < 600 )
            {
                sVar5 = 1;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
            {
                sVar5 = 4;
            }
            else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
            {
                sVar5 = 5;
            }

        }
        else if ( GET_FLOOR_ID() == GET_CNT( 5 ) && GET_FLOOR_ID() == GET_CNT( 6 ) )
        {
            
            if ( var32 < 300 )
            {
                sVar5 = 5;
            }
            else if ( var32 <= 600 )
            {
                sVar5 = 6;
            }
            else 
            {
                sVar5 = 1;
            }

        }

    }

}


void find_player()
{
    int var35 = RNG( 1000 );
    
    if ( GET_FLOOR_ID() == GET_CNT( 8 ) )
    {
        
        if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
        {
            sVar4 = 25;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
        {
            sVar4 = 48;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
        {
            sVar4 = 71;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
        {
            sVar4 = 94;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
        {
            sVar4 = 163;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 7 ) )
        {
            sVar4 = 117;
        }

    }
    else if ( GET_FLOOR_ID() == GET_CNT( 5 ) && GET_FLOOR_ID() == GET_CNT( 6 ) )
    {
        
        if ( var35 < 500 )
        {
            sVar4 = 94;
        }
        else 
        {
            sVar4 = 163;
        }

    }
    else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
    {
        
        if ( var35 < 500 )
        {
            sVar4 = 48;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
        {
            sVar4 = 71;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
        {
            sVar4 = 163;
        }

    }
    else if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
    {
        
        if ( var35 < 500 )
        {
            sVar4 = 25;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
        {
            sVar4 = 71;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
        {
            sVar4 = 94;
        }

    }
    else if ( GET_FLOOR_ID() == GET_CNT( 7 ) )
    {
        
        if ( var35 < 500 )
        {
            sVar4 = 117;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 1 ) )
        {
            sVar4 = 25;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 2 ) )
        {
            sVar4 = 48;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 3 ) )
        {
            sVar4 = 71;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 5 ) )
        {
            sVar4 = 94;
        }
        else if ( GET_FLOOR_ID() == GET_CNT( 6 ) )
        {
            sVar4 = 163;
        }

    }

}


void get_msg_yosuke()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 19;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 22;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 27;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 29;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 31;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 33;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 35;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 37;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 0x10;
    }

    choice_3_msg();
}


void get_msg_chie()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 42;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 45;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 50;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 52;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 54;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 56;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 58;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 60;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 39;
    }

    choice_3_msg();
}


void get_msg_yukiko()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 65;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 68;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 73;
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 75;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 77;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 79;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 81;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 83;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 62;
    }

    choice_3_msg();
}


void get_msg_kanji()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 88;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 91;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 96;
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 98;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 100;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 102;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 104;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 106;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 85;
    }

    choice_3_msg();
}


void get_msg_kuma()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 111;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 114;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 119;
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 121;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 123;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 125;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 127;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 129;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 108;
    }

    choice_3_msg();
}


void get_msg_rise()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 134;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 137;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 140;
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 142;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 144;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 146;
        }
        else if ( sVar5 == 6 )
        {
            sVar4 = 148;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 150;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 152;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 131;
    }

    choice_3_msg();
}


void get_msg_naoto()
{
    sVar4 = 0;
    
    if ( FLD_FUNCTION_0036() == 0 && FLD_FUNCTION_003A() == 1 )
    {
        sVar4 = 157;
    }
    else if ( FLD_FUNCTION_0038() == 1 )
    {
        sVar4 = 160;
    }
    else if ( FLD_FUNCTION_0042() == 1 )
    {
        get_npc();
        
        if ( sVar5 == 1 )
        {
            find_player();
        }
        else if ( sVar5 == 2 )
        {
            sVar4 = 165;
        }
        else if ( sVar5 == 3 )
        {
            sVar4 = 167;
        }
        else if ( sVar5 == 4 )
        {
            sVar4 = 169;
        }
        else if ( sVar5 == 5 )
        {
            sVar4 = 171;
        }
        else if ( sVar5 == 7 )
        {
            sVar4 = 173;
        }
        else if ( sVar5 == 8 )
        {
            sVar4 = 175;
        }

        choice_2_msg();
        return;
    }
    else if ( FLD_FUNCTION_0039() == 1 )
    {
        sVar4 = 154;
    }

    choice_3_msg();
}


void choice_2_msg()
{
    int var36 = RNG( 1000 );
    
    if ( sVar4 != 0 )
    {
        
        if ( var36 < 500 )
        {
            sVar4 = sVar4 + 1;
        }

    }

}


void choice_3_msg()
{
    int var37 = RNG( 900 );
    
    if ( sVar4 != 0 )
    {
        
        if ( var37 < 300 )
        {
            sVar4 = sVar4 + 1;
        }
        else if ( var37 < 600 )
        {
            sVar4 = sVar4 + 2;
        }

    }

}


void castle_05F_door()
{
    int var43 = FLD_FUNCTION_0025();
    int var39 = FLD_FUNCTION_0027();
    int var38 = FLD_FUNCTION_0014();
    int var45 = 0;
    int var40 = 0;
    
    if ( var38 == 10240 && BIT_CHK( 0 + 0x0400 + 0x0800 + 613 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( DOOR_LOCK );
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 612 ) == 1 )
        {
            change_speaker();
            BIT_ON( 0 + 0x0400 + 0x0800 + 613 );
            var45 = 0x0400 + 50;
            SET_MSG_VAR( 0, var45, 1 );
            MSG( OPEN_DOOR_LOCK );
            CLOSE_MSG_WIN();
        }
        else 
        {
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }

    }
    else if ( var38 == 10255 && BIT_CHK( 0 + 0x0400 + 0x0800 + 614 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( DOOR_LOCK );
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 612 ) == 1 )
        {
            change_speaker();
            BIT_ON( 0 + 0x0400 + 0x0800 + 614 );
            var45 = 0x0400 + 50;
            SET_MSG_VAR( 0, var45, 1 );
            MSG( OPEN_DOOR_LOCK );
            CLOSE_MSG_WIN();
        }
        else 
        {
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }

    }
    else if ( var38 == 10248 && BIT_CHK( 0 + 0x0400 + 0x0800 + 612 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var44 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( DOOR_CASTLE );
        FUNCTION_005D( var44 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var40 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var40 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 708 );
        FLD_FUNCTION_0010( var39, 0 );
        FLD_FUNCTION_0015();
        int var41 = FLD_FUNCTION_0011( 2, 310 );
        int var42 = FLD_FUNCTION_0012( var41, 0 );
        FLD_FUNCTION_000A( var42, 2.00f );
        FLD_FUNCTION_000C( var42, 12 );
        FLD_FUNCTION_0007( var42, 1 );
        var41 = FLD_FUNCTION_0011( 5, 5251 );
        var42 = FLD_FUNCTION_0012( var41, 0 );
        FLD_FUNCTION_000A( var42, 1.00f );
        FLD_FUNCTION_000C( var42, 0x10 );
        FLD_FUNCTION_0007( var42, 1 );
        sVar7 = 13;
        sVar8 = 14;
        int var9 = 15;
        sVar10 = 0;
        set_pc_pos();
        OPEN_MSG_WIN();
        MSG( CASTLE_ENC_1 );
        change_speaker();
        var44 = FUNCTION_005C( 280, -40, 8, 33 );
        MSG( CASTLE_ENC_2 );
        FUNCTION_005D( var44 );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 811, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_OFF( 0 + 0x0400 + 0x0800 + 611 );
        BIT_ON( 0 + 0x0400 + 0x0800 + 612 );
        var45 = 0x0400 + 50;
        FUNCTION_0053( var45, 1 );
        SET_MSG_VAR( 0, var45, 1 );
        OPEN_MSG_WIN();
        MSG( GET_KEY );
        change_speaker();
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        MSG( CASTLE_ENC_WIN_1 );
        change_speaker();
        var44 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( CASTLE_ENC_WIN_2 );
        FUNCTION_005D( var44 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void sauna_03F_door()
{
    int var51 = FLD_FUNCTION_0025();
    int var47 = FLD_FUNCTION_0027();
    int var46 = FLD_FUNCTION_0014();
    int var52 = 0;
    int var48 = 0;
    int var53 = 0;
    
    if ( var46 == 10252 && BIT_CHK( 0 + 33 ) == 0 )
    {
        OPEN_MSG_WIN();
        var52 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( DOOR_SAUNA );
        FUNCTION_005D( var52 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var48 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var48 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 709 );
        FLD_FUNCTION_0010( var47, 0 );
        FLD_FUNCTION_0015();
        eve_sauna_half();
        sVar6 = 1;
    }
    else if ( var46 == 10246 && BIT_CHK( 0 + 0x0400 + 0x0800 + 642 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( DOOR_LOCK );
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 643 ) == 1 )
        {
            change_speaker();
            BIT_ON( 0 + 0x0400 + 0x0800 + 642 );
            var53 = 0x0400 + 51;
            SET_MSG_VAR( 0, var53, 1 );
            MSG( OPEN_DOOR_LOCK );
            CLOSE_MSG_WIN();
        }
        else 
        {
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }

    }

}


void sauna_07F_door()
{
    int var59 = FLD_FUNCTION_0025();
    int var55 = FLD_FUNCTION_0027();
    int var54 = FLD_FUNCTION_0014();
    int var56 = 0;
    
    if ( var54 == 10242 && BIT_CHK( 0 + 0x0400 + 0x0800 + 643 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( SAUNA_ENC_DOOR_27 );
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var56 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var56 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 709 );
        FLD_FUNCTION_0010( var55, 0 );
        FLD_FUNCTION_0015();
        int var57 = FLD_FUNCTION_0011( 2, 311 );
        int var58 = FLD_FUNCTION_0012( var57, 0 );
        FLD_FUNCTION_000A( var58, 1.70f );
        FLD_FUNCTION_000C( var58, 0 );
        FLD_FUNCTION_0007( var58, 1 );
        var57 = FLD_FUNCTION_0011( 5, 5351 );
        var58 = FLD_FUNCTION_0012( var57, 0 );
        FLD_FUNCTION_000A( var58, 1.00f );
        FLD_FUNCTION_000C( var58, 5 );
        FLD_FUNCTION_0007( var58, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        OPEN_MSG_WIN();
        MSG( SAUNA_ENC_1 );
        change_speaker();
        int var60 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( SAUNA_ENC_2 );
        FUNCTION_005D( var60 );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 812, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 643 );
        OPEN_MSG_WIN();
        var60 = FUNCTION_005C( 280, -40, 8, 31 );
        MSG( SAUNA_ENC_WIN );
        FUNCTION_005D( var60 );
        change_speaker();
        int var61 = 0x0400 + 51;
        FUNCTION_0053( var61, 1 );
        SET_MSG_VAR( 0, var61, 1 );
        MSG( GET_KEY );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void playhouse_03F_door()
{
    int var67 = FLD_FUNCTION_0025();
    int var63 = FLD_FUNCTION_0027();
    int var62 = FLD_FUNCTION_0014();
    int var64 = 0;
    
    if ( var62 == 10245 && BIT_CHK( 0 + 34 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var68 = FUNCTION_005C( 280, -40, 8, 30 );
        MSG( DOOR_PLAYHOUSE );
        FUNCTION_005D( var68 );
        change_speaker();
        MSG( OPEN_DOOR_PH_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var64 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var64 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 711 );
        FLD_FUNCTION_0010( var63, 0 );
        FLD_FUNCTION_0015();
        eve_strip_half();
        sVar6 = 1;
    }

}


void playhouse_07F_door()
{
    int var74 = FLD_FUNCTION_0025();
    int var70 = FLD_FUNCTION_0027();
    int var69 = FLD_FUNCTION_0014();
    int var71 = 0;
    
    if ( var69 == 10307 && BIT_CHK( 0 + 0x0400 + 0x0800 + 679 ) == 0 )
    {
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( PLAYHOUSE_DOOR_STOP );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }
    else if ( var69 == 10271 && BIT_CHK( 0 + 0x0400 + 0x0800 + 679 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( PLAYHOUSE_ENC_DOOR_1 );
        change_speaker();
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        MSG( PLAYHOUSE_ENC_DOOR_2 );
        change_speaker();
        int var75 = FUNCTION_005C( 280, -40, 8, 33 );
        MSG( PLAYHOUSE_ENC_DOOR_3 );
        FUNCTION_005D( var75 );
        change_speaker();
        MSG( OPEN_DOOR_PH_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var71 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var71 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 711 );
        FLD_FUNCTION_0010( var70, 0 );
        FLD_FUNCTION_0015();
        int var72 = FLD_FUNCTION_0011( 5, 5301 );
        int var73 = FLD_FUNCTION_0012( var72, 0 );
        FLD_FUNCTION_000A( var73, 1.00f );
        FLD_FUNCTION_000C( var73, 5 );
        FLD_FUNCTION_0007( var73, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        OPEN_MSG_WIN();
        MSG( PLAYHOUSE_ENC_1 );
        CLOSE_MSG_WIN();
        PLAY_SOUNDEFFECT( 122 );
        FADE( 1, 5 );
        FUNCTION_0024( 255, 255, 255 );
        FADE_SYNC();
        FLD_FUNCTION_0007( var73, 0 );
        var72 = FLD_FUNCTION_0011( 2, 312 );
        var73 = FLD_FUNCTION_0012( var72, 0 );
        FLD_FUNCTION_000A( var73, 1.70f );
        FLD_FUNCTION_000C( var73, 0 );
        FLD_FUNCTION_0007( var73, 1 );
        FLD_FUNCTION_002F( 10, 0, 20 );
        FLD_FUNCTION_002E( 10, 0, 20 );
        FLD_FUNCTION_0030( 1421.30f );
        FLD_FUNCTION_0031( 3600 );
        FUNCTION_0015( 5 );
        FADE_SYNC();
        OPEN_MSG_WIN();
        var75 = FUNCTION_005C( 280, -40, 8, 33 );
        MSG( PLAYHOUSE_ENC_2 );
        FUNCTION_005D( var75 );
        CLOSE_MSG_WIN();
        BIT_ON( 0 + 0x0400 + 0x0800 + 679 );
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 813, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        OPEN_MSG_WIN();
        var75 = FUNCTION_005C( 280, -40, 8, 33 );
        MSG( PLAYHOUSE_ENC_WIN );
        FUNCTION_005D( var75 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void gameworld_07F_door()
{
    int var82 = FLD_FUNCTION_0025();
    int var78 = FLD_FUNCTION_0027();
    int var77 = FLD_FUNCTION_0014();
    int var79 = 0;
    
    if ( var77 == 10246 && BIT_CHK( 0 + 0x0400 + 0x0800 + 707 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var83 = FUNCTION_005C( 280, -40, 5, 20 );
        MSG( GAMEWORLD_ENC_DOOR );
        FUNCTION_005D( var83 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var79 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var79 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 712 );
        FLD_FUNCTION_0010( var78, 0 );
        FLD_FUNCTION_0015();
        int var80 = FLD_FUNCTION_0011( 2, 313 );
        int var81 = FLD_FUNCTION_0012( var80, 0 );
        FLD_FUNCTION_000A( var81, 1.40f );
        FLD_FUNCTION_000C( var81, 0 );
        FLD_FUNCTION_0007( var81, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        OPEN_MSG_WIN();
        MSG( GAMEWORLD_ENC );
        CLOSE_MSG_WIN();
        BIT_ON( 0 + 0x0400 + 0x0800 + 707 );
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 814, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        OPEN_MSG_WIN();
        var83 = FUNCTION_005C( 280, -40, 5, 21 );
        MSG( GAMEWORLD_ENC_WIN );
        FUNCTION_005D( var83 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void base_04F_door()
{
    int var90 = FLD_FUNCTION_0025();
    int var86 = FLD_FUNCTION_0027();
    int var85 = FLD_FUNCTION_0014();
    int var92 = 0;
    int var87 = 0;
    
    if ( var85 == 10251 && BIT_CHK( 0 + 0x0400 + 0x0800 + 739 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( DOOR_LOCK_084 );
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 737 ) == 1 )
        {
            change_speaker();
            BIT_ON( 0 + 0x0400 + 0x0800 + 739 );
            var92 = 0x0400 + 52;
            SET_MSG_VAR( 0, var92, 1 );
            MSG( OPEN_DOOR_LOCK );
            CLOSE_MSG_WIN();
        }
        else 
        {
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }

    }
    else if ( var85 == 10253 && BIT_CHK( 0 + 0x0400 + 0x0800 + 741 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var91 = FUNCTION_005C( 280, -40, 5, 20 );
        MSG( BASE_ENC_DOOR );
        FUNCTION_005D( var91 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var87 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var87 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 710 );
        FLD_FUNCTION_0010( var86, 0 );
        FLD_FUNCTION_0015();
        int var88 = FLD_FUNCTION_0011( 2, 314 );
        int var89 = FLD_FUNCTION_0012( var88, 0 );
        FLD_FUNCTION_000A( var89, 1.70f );
        FLD_FUNCTION_000C( var89, 0 );
        FLD_FUNCTION_0007( var89, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        PLAY_SOUNDEFFECT( 229 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( BASE_ENC );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 815, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 741 );
        OPEN_MSG_WIN();
        var91 = FUNCTION_005C( 280, -40, 5, 21 );
        MSG( BASE_ENC_WIN );
        FUNCTION_005D( var91 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void base_06F_door()
{
    int var98 = FLD_FUNCTION_0025();
    int var94 = FLD_FUNCTION_0027();
    int var93 = FLD_FUNCTION_0014();
    int var100 = 0;
    
    if ( var93 == 10246 && BIT_CHK( 0 + 0x0400 + 0x0800 + 740 ) == 0 )
    {
        OPEN_MSG_WIN();
        MSG( DOOR_LOCK_086 );
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 738 ) == 1 )
        {
            change_speaker();
            BIT_ON( 0 + 0x0400 + 0x0800 + 740 );
            var100 = 0x0400 + 53;
            SET_MSG_VAR( 0, var100, 1 );
            MSG( OPEN_DOOR_LOCK );
            CLOSE_MSG_WIN();
        }
        else if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 737 ) == 1 )
        {
            change_speaker();
            var100 = 0x0400 + 52;
            SET_MSG_VAR( 0, var100, 1 );
            MSG( NOT_OPEN_DOOR_LOCK );
        }

        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void heaven_04F_door()
{
    int var106 = FLD_FUNCTION_0025();
    int var102 = FLD_FUNCTION_0027();
    int var101 = FLD_FUNCTION_0014();
    
    if ( var101 == 10252 && BIT_CHK( 0 + 41 ) == 0 )
    {
        PLAY_SOUNDEFFECT( 713 );
        FLD_FUNCTION_0008( var101, var106, 0, 0, 1 );
        FLD_FUNCTION_0009( var101 );
        FLD_FUNCTION_0010( var102, 0 );
        FLD_FUNCTION_0015();
        FADE( 1, 10 );
        FADE_SYNC();
        eve_heaven_half();
        sVar6 = 1;
    }

}


void heaven_07F_door()
{
    int var113 = FLD_FUNCTION_0025();
    int var109 = FLD_FUNCTION_0027();
    int var108 = FLD_FUNCTION_0014();
    int var110 = 0;
    
    if ( var108 == 10262 && BIT_CHK( 0 + 0x0400 + 0x0800 + 769 ) == 0 )
    {
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( HEAVEN_ENC_DOOR );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var110 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var110 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 713 );
        FLD_FUNCTION_0010( var109, 0 );
        FLD_FUNCTION_0015();
        int var111 = FLD_FUNCTION_0011( 2, 315 );
        int var112 = FLD_FUNCTION_0012( var111, 0 );
        FLD_FUNCTION_000A( var112, 3.90f );
        FLD_FUNCTION_000C( var112, 0 );
        FLD_FUNCTION_0007( var112, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( HEAVEN_ENC_1 );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 816, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 769 );
        OPEN_MSG_WIN();
        int var114 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( HEAVEN_ENC_WIN );
        FUNCTION_005D( var114 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void city_02F_door()
{
    int var120 = FLD_FUNCTION_0025();
    int var116 = FLD_FUNCTION_0027();
    int var115 = FLD_FUNCTION_0014();
    int var121 = 0;
    
    if ( var115 == 10241 || var115 == 10242 && BIT_CHK( 0 + 0x0400 + 0x0800 + 804 ) == 0 )
    {
        OPEN_MSG_WIN();
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 803 ) == 0 )
        {
            BIT_ON( 0 + 0x0400 + 0x0800 + 803 );
            MSG( CITY_2F_LOCK_DOOR );
            change_speaker();
            PLAY_SOUNDEFFECT( 241 );
            NS_WAIT( 10 );
            MSG( CITY_2F_LOCK_DOOR_A );
            change_speaker();
            var121 = FUNCTION_005C( 280, -40, 5, 0x20 );
            MSG( CITY_2F_LOCK_NOTOPEN_A );
            FUNCTION_005D( var121 );
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }
        else if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 802 ) != 1 )
        {
            MSG( CITY_2F_LOCK_DOOR );
            change_speaker();
            var121 = FUNCTION_005C( 280, -40, 5, 0x20 );
            MSG( CITY_2F_LOCK_NOTOPEN );
            FUNCTION_005D( var121 );
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }
        else if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 802 ) == 1 )
        {
            var121 = FUNCTION_005C( 280, -40, 5, 30 );
            MSG( CITY_2F_LOCK_OPEN_1 );
            FUNCTION_005D( var121 );
            CLOSE_MSG_WIN();
            PLAY_SOUNDEFFECT( 714 );
            NS_WAIT( 2 );
            FLD_FUNCTION_0008( var115, var120, 0, 0, 1 );
            FLD_FUNCTION_0009( var115 );
            FLD_FUNCTION_0010( var116, 0 );
            FLD_FUNCTION_0015();
            BIT_ON( 0 + 0x0400 + 0x0800 + 804 );
            OPEN_MSG_WIN();
            var121 = FUNCTION_005C( 280, -40, 5, 30 );
            MSG( CITY_2F_LOCK_OPEN_2 );
            FUNCTION_005D( var121 );
            CLOSE_MSG_WIN();
            sVar6 = 1;
            return;
        }

    }

}


void city_05F_door()
{
    int var127 = FLD_FUNCTION_0025();
    int var123 = FLD_FUNCTION_0027();
    int var122 = FLD_FUNCTION_0014();
    int var124 = 0;
    
    if ( var122 == 10241 && BIT_CHK( 0 + 0x0400 + 0x0800 + 801 ) == 0 )
    {
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( CITY_ENC_5F_DOOR );
        change_speaker();
        MSG( OPEN_NOT_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var124 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var124 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 714 );
        FLD_FUNCTION_0010( var123, 0 );
        FLD_FUNCTION_0015();
        int var125 = FLD_FUNCTION_0011( 2, 316 );
        int var126 = FLD_FUNCTION_0012( var125, 0 );
        FLD_FUNCTION_000A( var126, 2.00f );
        FLD_FUNCTION_000C( var126, 0 );
        FLD_FUNCTION_0007( var126, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        BIT_ON( 0 + 0x0400 + 0x0800 + 801 );
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( CITY_ENC_5F );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 817, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( CITY_ENC_5F_WIN_1 );
        change_speaker();
        int var128 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( CITY_ENC_5F_WIN_2 );
        FUNCTION_005D( var128 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void city_08F_door()
{
    int var134 = FLD_FUNCTION_0025();
    int var130 = FLD_FUNCTION_0027();
    int var129 = FLD_FUNCTION_0014();
    int var131 = 0;
    
    if ( var129 == 10242 && BIT_CHK( 0 + 0x0400 + 0x0800 + 802 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var135 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( CITY_ENC_8F_DOOR );
        FUNCTION_005D( var135 );
        change_speaker();
        MSG( OPEN_NOT_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var131 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var131 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 714 );
        FLD_FUNCTION_0010( var130, 0 );
        FLD_FUNCTION_0015();
        int var132 = FLD_FUNCTION_0011( 2, 317 );
        int var133 = FLD_FUNCTION_0012( var132, 0 );
        FLD_FUNCTION_000A( var133, 1.70f );
        FLD_FUNCTION_000C( var133, 0 );
        FLD_FUNCTION_0007( var133, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        OPEN_MSG_WIN();
        var135 = FUNCTION_005C( 280, -40, 5, 0x20 );
        MSG( CITY_ENC_8F_1 );
        FUNCTION_005D( var135 );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 818, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 802 );
        OPEN_MSG_WIN();
        var135 = FUNCTION_005C( 280, -40, 5, 31 );
        MSG( CITY_ENC_8F_WIN );
        FUNCTION_005D( var135 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void last_03F_door()
{
    int var141 = FLD_FUNCTION_0025();
    int var137 = FLD_FUNCTION_0027();
    int var136 = FLD_FUNCTION_0014();
    int var138 = 0;
    
    if ( var136 == 10262 && BIT_CHK( 0 + 0x0400 + 0x0800 + 865 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var142 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( LAST_ENC_3F_DOOR );
        FUNCTION_005D( var142 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var138 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var138 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 715 );
        FLD_FUNCTION_0010( var137, 0 );
        FLD_FUNCTION_0015();
        int var139 = FLD_FUNCTION_0011( 2, 318 );
        int var140 = FLD_FUNCTION_0012( var139, 0 );
        FLD_FUNCTION_000A( var140, 1.70f );
        FLD_FUNCTION_000C( var140, 0 );
        FLD_FUNCTION_0007( var140, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( LAST_ENC_3F );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 819, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 865 );
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( LAST_ENC_3F_WIN );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void last_06F_door()
{
    int var148 = FLD_FUNCTION_0025();
    int var144 = FLD_FUNCTION_0027();
    int var143 = FLD_FUNCTION_0014();
    int var145 = 0;
    
    if ( var143 == 10254 && BIT_CHK( 0 + 0x0400 + 0x0800 + 866 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var149 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( LAST_ENC_6F_DOOR );
        FUNCTION_005D( var149 );
        change_speaker();
        MSG( OPEN_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var145 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var145 == 1 )
        {
            sVar6 = 1;
            return;
        }

        FADE( 1, 10 );
        FADE_SYNC();
        PLAY_SOUNDEFFECT( 715 );
        FLD_FUNCTION_0010( var144, 0 );
        FLD_FUNCTION_0015();
        int var146 = FLD_FUNCTION_0011( 2, 319 );
        int var147 = FLD_FUNCTION_0012( var146, 0 );
        FLD_FUNCTION_000A( var147, 2.00f );
        FLD_FUNCTION_000C( var147, 0 );
        FLD_FUNCTION_0007( var147, 1 );
        sVar7 = 1;
        sVar8 = 2;
        var9 = 3;
        sVar10 = 4;
        set_pc_pos();
        PLAY_SOUNDEFFECT( 241 );
        NS_WAIT( 10 );
        OPEN_MSG_WIN();
        MSG( LAST_ENC_6F );
        CLOSE_MSG_WIN();
        NS_WAIT( 15 );
        
        if ( CALL_BATTLE( 820, 1 ) == 1 )
        {
            sVar6 = 1;
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 866 );
        OPEN_MSG_WIN();
        var149 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( LAST_ENC_6F_WIN );
        FUNCTION_005D( var149 );
        CLOSE_MSG_WIN();
        sVar6 = 1;
        return;
    }

}


void first_door()
{
    int var153 = FLD_FUNCTION_0025();
    int var151 = FLD_FUNCTION_0027();
    int var150 = FLD_FUNCTION_0014();
    sVar6 = 1;
    OPEN_MSG_WIN();
    MSG( FIRST_DOOR );
    MSG( OPEN_FDOOR_OK );
    SET_SEL_CHOICE_KEYBIND( 14, 1 );
    int var152 = SEL( YESNO_SEL );
    CLOSE_MSG_WIN();
    
    if ( var152 == 1 )
    {
        return;
    }

    PLAY_SOUNDEFFECT( 193 );
    NS_WAIT( 4 );
    FLD_FUNCTION_0008( var150, var153, 0, 0, 0.10f );
    NS_WAIT( 100 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 0 );
    AI_FUNCTION_00DC( 532 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    TV_STUDIO();
}


void tomb_01F_door_enc()
{
    int var161 = RNG( 1000 );
    int var157 = FLD_FUNCTION_0025();
    int var156 = FLD_FUNCTION_0027();
    int var155 = FLD_FUNCTION_0014();
    sVar6 = 1;
    int var158 = FLD_FUNCTION_0029( 2 );
    int var160 = 0;
    int var154 = 0;
    
    if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 834 ) == 0 )
    {
        OPEN_MSG_WIN();
        
        if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 839 ) == 0 )
        {
            BIT_ON( 0 + 0x0400 + 0x0800 + 839 );
            var160 = FUNCTION_005C( 280, -40, 5, 33 );
            MSG( TOMB_ENC_1F_DOOR_1 );
        }
        else 
        {
            var160 = FUNCTION_005C( 280, -40, 5, 30 );
            MSG( TOMB_ENC_1F_DOOR_2 );
        }

        FUNCTION_005D( var160 );
        change_speaker();
        OPEN_MSG_WIN();
        MSG( OPEN_NOT_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var154 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var154 == 1 )
        {
            return;
        }

    }

    PLAY_SOUNDEFFECT( 741 );
    NS_WAIT( 1 );
    FLD_FUNCTION_0043( var155 );
    FLD_FUNCTION_0008( var155, var157, 0, 0, 1 );
    FLD_FUNCTION_0009( var155 );
    FLD_FUNCTION_0010( var156, 0 );
    FLD_FUNCTION_0015();
    int var159 = 0;
    
    if ( var155 == 10254 && BIT_CHK( 0 + 0x0400 + 0x0800 + 844 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 844 );
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( 880, 0 );
    }
    else if ( var155 == 10244 && BIT_CHK( 0 + 0x0400 + 0x0800 + 845 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 845 );
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( 883, 0 );
    }
    else if ( var155 == 10251 && BIT_CHK( 0 + 0x0400 + 0x0800 + 846 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 846 );
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( 887, 0 );
    }
    else if ( var155 == 10249 && BIT_CHK( 0 + 0x0400 + 0x0800 + 847 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 847 );
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( 941, 0 );
    }
    else if ( var155 == 10244 || var155 == 10251 )
    {
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( 941, 0 );
    }
    else if ( var155 != 10241 && var161 <= 200 )
    {
        NS_WAIT( 10 );
        var159 = CALL_BATTLE( var158, 0 );
    }

    
    if ( var159 == 1 )
    {
        dng_decease_2();
        return;
    }

}


void tomb_04F_door_enc()
{
    int var169 = RNG( 1000 );
    int var165 = FLD_FUNCTION_0025();
    int var164 = FLD_FUNCTION_0027();
    int var163 = FLD_FUNCTION_0014();
    sVar6 = 1;
    int var166 = FLD_FUNCTION_0029( 2 );
    int var162 = 0;
    
    if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 835 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var168 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_5F_DOOR );
        FUNCTION_005D( var168 );
        change_speaker();
        OPEN_MSG_WIN();
        MSG( OPEN_NOT_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var162 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var162 == 1 )
        {
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 835 );
    }

    PLAY_SOUNDEFFECT( 741 );
    NS_WAIT( 1 );
    FLD_FUNCTION_0043( var163 );
    FLD_FUNCTION_0008( var163, var165, 0, 0, 1 );
    FLD_FUNCTION_0009( var163 );
    FLD_FUNCTION_0010( var164, 0 );
    FLD_FUNCTION_0015();
    int var167 = 0;
    
    if ( var163 == 10257 && BIT_CHK( 0 + 0x0400 + 0x0800 + 840 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 840 );
        NS_WAIT( 10 );
        var167 = CALL_BATTLE( 938, 0 );
    }
    else if ( var163 == 10257 || var163 == 10269 || var163 == 10272 || var163 == 10281 || var163 == 10299 || var163 == 10311 || var163 == 10320 || var163 == 10329 )
    {
        NS_WAIT( 10 );
        var167 = CALL_BATTLE( var166, 0 );
    }
    else if ( var169 <= 200 )
    {
        NS_WAIT( 10 );
        var167 = CALL_BATTLE( var166, 0 );
    }

    
    if ( var167 == 1 )
    {
        dng_decease_2();
        return;
    }

}


void tomb_07F_door_enc()
{
    int var177 = RNG( 1000 );
    int var173 = FLD_FUNCTION_0025();
    int var172 = FLD_FUNCTION_0027();
    int var171 = FLD_FUNCTION_0014();
    sVar6 = 1;
    int var174 = FLD_FUNCTION_0029( 2 );
    int var170 = 0;
    
    if ( BIT_CHK( 0 + 0x0400 + 0x0800 + 836 ) == 0 )
    {
        OPEN_MSG_WIN();
        int var176 = FUNCTION_005C( 280, -40, 5, 30 );
        MSG( TOMB_ENC_7F_DOOR_1 );
        FUNCTION_005D( var176 );
        var176 = FUNCTION_005C( 280, -40, 5, 0x20 );
        MSG( TOMB_ENC_7F_DOOR_2 );
        FUNCTION_005D( var176 );
        change_speaker();
        MSG( OPEN_NOT_DOOR_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var170 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var170 == 1 )
        {
            return;
        }

        BIT_ON( 0 + 0x0400 + 0x0800 + 836 );
    }

    PLAY_SOUNDEFFECT( 741 );
    NS_WAIT( 1 );
    FLD_FUNCTION_0043( var171 );
    FLD_FUNCTION_0008( var171, var173, 0, 0, 1 );
    FLD_FUNCTION_0009( var171 );
    FLD_FUNCTION_0010( var172, 0 );
    FLD_FUNCTION_0015();
    int var175 = 0;
    
    if ( var171 == 10290 && BIT_CHK( 0 + 0x0400 + 0x0800 + 841 ) == 0 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 841 );
        NS_WAIT( 10 );
        var175 = CALL_BATTLE( 939, 0 );
    }
    else if ( var171 == 10245 || var171 == 10249 || var171 == 10255 || var171 == 10259 || var171 == 10268 || var171 == 10300 || var171 == 10290 )
    {
        NS_WAIT( 10 );
        var175 = CALL_BATTLE( var174, 0 );
    }
    else if ( var177 <= 200 )
    {
        NS_WAIT( 10 );
        var175 = CALL_BATTLE( var174, 0 );
    }

    
    if ( var175 == 1 )
    {
        dng_decease_2();
        return;
    }

}


void get_box_item_id()
{
    sVar3 = FLD_FUNCTION_0019();
    
    if ( FLD_FUNCTION_001A() == 4 )
    {
        sVar0 = FLD_FUNCTION_001C();
        sVar0 = sVar0 - sVar0 * RNG( 3000 ) / 10000;
    }
    else 
    {
        sVar1 = FLD_FUNCTION_001D();
        sVar2 = FLD_FUNCTION_001E();
    }

}


void itembox_open_anim()
{
    FLD_FUNCTION_0008( sVar3, 1, 0, 0, 1.00f );
    NS_WAIT( 10 );
    FUNCTION_0023( 3, 1 );
    NS_WAIT( 15 );
    FLD_FUNCTION_001F();
}


void death_check()
{
    int var178 = GET_CNT( 38 );
    
    if ( GET_FLOOR_ID() < 160 && BIT_CHK( 0 + 0x0400 + 0x0800 + 8 ) == 0 )
    {
        
        if ( var178 >= 21 )
        {
            var178 = 0;
        }
        else 
        {
            var178 = var178 + 1;
        }

        SET_CNT( 38, var178 );
        
        if ( var178 == 13 && BIT_CHK( 0 + 0x0400 + 0x0800 + 46 ) == 0 )
        {
            BIT_ON( 0 + 0x0400 + 0x0800 + 46 );
        }
        else 
        {
            BIT_OFF( 0 + 0x0400 + 0x0800 + 46 );
        }

    }

}


void death_box()
{
    int var180 = RNG( 1000 );
    int var185 = 0;
    BIT_OFF( 0 + 0x0400 + 0x0800 + 46 );
    BIT_ON( 0 + 0x0400 + 0x0800 + 47 );
    OPEN_MSG_WIN();
    MSG( DEATH_WAIT );
    MSG( DEATH_BOX );
    SET_SEL_CHOICE_KEYBIND( 14, 1 );
    int var179 = SEL( YESNO_SEL );
    CLOSE_MSG_WIN();
    int var183 = 0;
    int var184 = 0;
    int var181 = 0;
    int var182 = 0;
    
    if ( var179 == 0 )
    {
        OPEN_MSG_WIN();
        
        if ( BIT_CHK( 0 + 52 ) == 1 )
        {
            var183 = FUNCTION_005C( 280, -40, 5, 30 );
            MSG( DEATH_RISE );
        }
        else 
        {
            var183 = FUNCTION_005C( 280, -40, 8, 30 );
            MSG( DEATH_KUMA );
        }

        FUNCTION_005D( var183 );
        change_speaker();
        MSG( DEATH_BOX_OPEN_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var179 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var179 == 0 )
        {
            itembox_open_anim();
            OPEN_MSG_WIN();
            MSG( DEATH_ENCOUNT );
            CLOSE_MSG_WIN();
            BIT_OFF( 0 + 0x0400 + 0x0800 + 47 );
            SET_CNT( 38, 14 );
            NS_WAIT( 10 );
            var184 = CALL_BATTLE( 801, 0 );
            
            if ( var184 != 0 || gVar9 == 1 )
            {
                
                if ( var184 == 1 )
                {
                    gVar9 = 0;
                    dng_decease_2();
                }
                else if ( gVar9 == 1 )
                {
                    encount_trap();
                }

                return;
            }

            
            if ( var180 >= 100 && FUNCTION_0052( 0 + 36 ) == 0 && GET_EQUIPMENT_ID( PartyUnit.Protagonist, 0 ) != 0 + 36 )
            {
                var181 = 0 + 36;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 2 || GET_PARTY_MEMBER_ID( 1 ) == 2 || GET_PARTY_MEMBER_ID( 2 ) == 2 && GET_EQUIPMENT_ID( PartyUnit.Yosuke, 0 ) != 0 + 70 && FUNCTION_0052( 0 + 70 ) == 0 )
            {
                var181 = 0 + 70;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 3 || GET_PARTY_MEMBER_ID( 1 ) == 3 || GET_PARTY_MEMBER_ID( 2 ) == 3 && GET_EQUIPMENT_ID( PartyUnit.Chie, 0 ) != 0 + 142 && FUNCTION_0052( 0 + 142 ) == 0 )
            {
                var181 = 0 + 142;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 4 || GET_PARTY_MEMBER_ID( 1 ) == 4 || GET_PARTY_MEMBER_ID( 2 ) == 4 && GET_EQUIPMENT_ID( PartyUnit.Yukiko, 0 ) != 0 + 104 && FUNCTION_0052( 0 + 104 ) == 0 )
            {
                var181 = 0 + 104;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 6 || GET_PARTY_MEMBER_ID( 1 ) == 6 || GET_PARTY_MEMBER_ID( 2 ) == 6 && GET_EQUIPMENT_ID( PartyUnit.Kanji, 0 ) != 0 + 175 && FUNCTION_0052( 0 + 175 ) == 0 )
            {
                var181 = 0 + 175;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 8 || GET_PARTY_MEMBER_ID( 1 ) == 8 || GET_PARTY_MEMBER_ID( 2 ) == 8 && GET_EQUIPMENT_ID( PartyUnit.Teddie, 0 ) != 0 + 238 && FUNCTION_0052( 0 + 238 ) == 0 )
            {
                var181 = 0 + 238;
            }
            else if ( var180 >= 100 && GET_PARTY_MEMBER_ID( 0 ) == 7 || GET_PARTY_MEMBER_ID( 1 ) == 7 || GET_PARTY_MEMBER_ID( 2 ) == 7 && GET_EQUIPMENT_ID( PartyUnit.Naoto, 0 ) != 0 + 197 && FUNCTION_0052( 0 + 197 ) == 0 )
            {
                var181 = 0 + 197;
            }
            else if ( var180 <= 900 )
            {
                var181 = 0x0100 + 162;
            }
            else 
            {
                var181 = 0x0200 + 95;
            }

            var182 = FUNCTION_0052( var181 ) + 1;
            FUNCTION_0053( var181, var182 );
            SET_MSG_VAR( 0, var181, 1 );
            SET_MSG_VAR( 1, 1, 0 );
            OPEN_MSG_WIN();
            MSG( GET_ITEM_MES );
            CLOSE_MSG_WIN();
        }
        else if ( var179 == 1 )
        {
            var185 = 1;
        }

    }
    else if ( var179 == 1 )
    {
        var185 = 1;
    }

    
    if ( var185 == 1 )
    {
        BIT_ON( 0 + 0x0400 + 0x0800 + 46 );
        BIT_OFF( 0 + 0x0400 + 0x0800 + 47 );
    }

}


void encount_box()
{
    itembox_open_anim();
    death_check();
    trap_encount();
}


void trap_encount()
{
    gVar9 = 0;
    int var189 = RNG( 1000 );
    int var190 = RNG( 1000 );
    int var186 = 0;
    
    if ( var190 < 800 && FUNCTION_004C() == 7 )
    {
        var186 = FLD_FUNCTION_0029( 4 );
    }
    else if ( var190 < 200 )
    {
        var186 = FLD_FUNCTION_0029( 4 );
    }
    else 
    {
        var186 = FLD_FUNCTION_0029( 0 );
    }

    
    if ( GET_FLOOR_ID() == 125 && BIT_CHK( 0 + 0x0400 + 0x0800 + 801 ) == 0 )
    {
        gVar9 = 1;
    }

    OPEN_MSG_WIN();
    MSG( TRAPBOX_ENCOUNT );
    CLOSE_MSG_WIN();
    NS_WAIT( 10 );
    int var191 = CALL_BATTLE( var186, 0 );
    
    if ( var191 != 0 || gVar9 == 1 )
    {
        
        if ( var191 == 1 )
        {
            gVar9 = 0;
            dng_decease_2();
        }
        else if ( gVar9 == 1 )
        {
            encount_trap();
        }

        return;
    }

    int var187 = 0;
    
    if ( var189 < 333 )
    {
        var187 = 768 + 22;
    }
    else if ( var189 < 666 )
    {
        var187 = 768 + 5;
    }
    else 
    {
        var187 = 768 + 12;
    }

    int var188 = FUNCTION_0052( var187 ) + 1;
    FUNCTION_0053( var187, var188 );
    SET_MSG_VAR( 0, var187, 1 );
    SET_MSG_VAR( 1, 1, 0 );
    OPEN_MSG_WIN();
    MSG( GET_ITEM_MES );
    CLOSE_MSG_WIN();
}


void rank_box()
{
    int var194 = 0;
    int var192 = 0;
    
    if ( FUNCTION_0052( 0x0800 + 55 ) > 0 )
    {
        var194 = 9;
        var192 = 0x0800 + 55;
    }
    else 
    {
        var194 = 10;
        var192 = 768 + 65;
    }

    int var193 = FUNCTION_0052( var192 );
    OPEN_MSG_WIN();
    int var195 = 0;
    
    if ( var193 > 0 )
    {
        SET_MSG_VAR( 0, var193, 0 );
        MSG( var194 );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var195 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var195 == 0 )
        {
            var193 = var193 - 1;
            FUNCTION_0053( var192, var193 );
            itembox_open_anim();
            death_check();
            itembox_open();
        }

    }
    else 
    {
        MSG( LOCK_BOX );
    }

    CLOSE_MSG_WIN();
}


void no_rank_box()
{
    itembox_open_anim();
    death_check();
    itembox_open();
}


void itembox_open()
{
    int var196 = FUNCTION_0052( sVar1 ) + sVar2;
    OPEN_MSG_WIN();
    
    if ( sVar0 > 0 )
    {
        FUNCTION_0050( sVar0 );
        SET_MSG_VAR( 0, sVar0, 0 );
        MSG( GET_MONEY_MES );
    }
    else 
    {
        FUNCTION_0053( sVar1, var196 );
        SET_MSG_VAR( 0, sVar1, 1 );
        SET_MSG_VAR( 1, sVar2, 0 );
        MSG( GET_ITEM_MES );
    }

    CLOSE_MSG_WIN();
}


void tomb_enc_box()
{
    
    if ( FLD_FUNCTION_0026() == 8 )
    {
        itembox_open_anim();
        tomb_enc_box_rank_8();
    }
    else if ( FLD_FUNCTION_0026() == 9 )
    {
        tomb_enc_box_rank_9();
    }

}


void tomb_enc_box_rank_8()
{
    int var197 = GET_FLOOR_ID();
    int var199 = RNG( 1000 );
    int var200 = RNG( 1000 );
    int var198 = 0;
    int var201 = 0;
    
    if ( var197 == 163 || var197 == 164 )
    {
        
        if ( var199 < 500 )
        {
            var198 = 545;
        }
        else 
        {
            var198 = 546;
        }

    }
    else if ( var197 == 165 )
    {
        
        if ( var199 < 500 )
        {
            var198 = 547;
        }
        else 
        {
            var198 = 548;
        }

    }
    else if ( var197 == 166 )
    {
        
        if ( var199 < 500 )
        {
            var198 = 553;
        }
        else 
        {
            var198 = 554;
        }

    }
    else if ( var197 == 167 )
    {
        
        if ( var199 < 500 )
        {
            var198 = 555;
        }
        else 
        {
            var198 = 556;
        }

    }
    else if ( var197 == 168 || var197 == 169 )
    {
        
        if ( var199 < 500 )
        {
            var198 = 557;
        }
        else 
        {
            var198 = 558;
        }

    }

    
    if ( var197 == 163 || var197 == 164 )
    {
        
        if ( var200 < 250 )
        {
            var201 = 0x0200 + 176;
        }
        else if ( var200 < 500 )
        {
            var201 = 0x0200 + 177;
        }
        else 
        {
            var201 = 768 + 163;
        }

    }
    else if ( var197 == 165 || var197 == 166 || var197 == 167 )
    {
        
        if ( var200 < 250 )
        {
            var201 = 768 + 161;
        }
        else if ( var200 < 400 )
        {
            var201 = 0x0200 + 178;
        }
        else if ( var200 < 550 )
        {
            var201 = 0x0100 + 165;
        }
        else if ( var200 < 700 )
        {
            var201 = 0x0100 + 166;
        }
        else if ( var200 < 850 )
        {
            var201 = 0x0100 + 167;
        }
        else 
        {
            var201 = 0x0100 + 168;
        }

    }
    else if ( var197 == 168 || var197 == 169 )
    {
        
        if ( var200 < 150 )
        {
            var201 = 768 + 113;
        }
        else if ( var200 < 300 )
        {
            var201 = 768 + 114;
        }
        else if ( var200 < 450 )
        {
            var201 = 768 + 115;
        }
        else if ( var200 < 600 )
        {
            var201 = 768 + 116;
        }
        else if ( var200 < 700 )
        {
            var201 = 0x0100 + 169;
        }
        else if ( var200 < 800 )
        {
            var201 = 0x0100 + 170;
        }
        else if ( var200 < 900 )
        {
            var201 = 0x0100 + 171;
        }
        else 
        {
            var201 = 0x0100 + 172;
        }

    }

    OPEN_MSG_WIN();
    MSG( TRAPBOX_ENCOUNT );
    CLOSE_MSG_WIN();
    NS_WAIT( 10 );
    int var203 = CALL_BATTLE( var198, 0 );
    
    if ( var203 != 0 )
    {
        
        if ( var203 == 1 )
        {
            gVar9 = 0;
            dng_decease_2();
        }

        return;
    }

    int var202 = FUNCTION_0052( var201 ) + 1;
    FUNCTION_0053( var201, var202 );
    SET_MSG_VAR( 0, var201, 1 );
    SET_MSG_VAR( 1, 1, 0 );
    OPEN_MSG_WIN();
    MSG( GET_ITEM_MES );
    CLOSE_MSG_WIN();
}


void tomb_enc_box_rank_9()
{
    int var204 = GET_FLOOR_ID();
    int var206 = RNG( 1000 );
    int var207 = RNG( 1000 );
    int var205 = 0;
    int var208 = 0;
    int var210 = 0;
    
    if ( var204 == 161 )
    {
        var205 = 544;
    }
    else if ( var204 == 162 )
    {
        
        if ( var206 < 500 )
        {
            var205 = 544;
        }
        else 
        {
            var205 = 545;
        }

    }
    else if ( var204 == 163 )
    {
        var205 = 549;
    }
    else if ( var204 == 164 )
    {
        
        if ( var206 < 500 )
        {
            var205 = 549;
        }
        else 
        {
            var205 = 550;
        }

    }
    else if ( var204 == 165 )
    {
        
        if ( var206 < 500 )
        {
            var205 = 550;
        }
        else 
        {
            var205 = 551;
        }

    }
    else if ( var204 == 166 || var204 == 167 )
    {
        var205 = 894;
    }
    else if ( var204 == 168 || var204 == 169 )
    {
        
        if ( var206 < 500 )
        {
            var205 = 894;
        }
        else 
        {
            var205 = 895;
        }

    }

    
    if ( var204 >= 161 && var204 <= 164 )
    {
        
        if ( var207 < 200 )
        {
            var208 = 0x0100 + 165;
        }
        else if ( var207 < 400 )
        {
            var208 = 0x0100 + 166;
        }
        else if ( var207 < 600 )
        {
            var208 = 0x0100 + 167;
        }
        else if ( var207 < 800 )
        {
            var208 = 0x0100 + 168;
        }
        else if ( var204 == 161 || var204 == 162 )
        {
            var208 = 0x0200 + 177;
        }
        else if ( var204 == 163 || var204 == 164 )
        {
            
            if ( var207 < 900 )
            {
                var208 = 0x0200 + 178;
            }
            else 
            {
                var208 = 0x0200 + 179;
            }

        }

    }
    else if ( var204 == 165 || var204 == 166 || var204 == 167 )
    {
        
        if ( var207 < 100 )
        {
            var208 = 0x0200 + 179;
        }
        else if ( var207 < 200 )
        {
            var208 = 0x0200 + 180;
        }
        else if ( var207 < 400 )
        {
            var208 = 0x0100 + 169;
        }
        else if ( var207 < 600 )
        {
            var208 = 0x0100 + 170;
        }
        else if ( var207 < 800 )
        {
            var208 = 0x0100 + 171;
        }
        else 
        {
            var208 = 0x0100 + 172;
        }

    }
    else if ( var204 == 168 || var204 == 169 )
    {
        
        if ( var207 < 500 )
        {
            var208 = 0x0200 + 179;
        }
        else if ( var207 < 750 )
        {
            var208 = 0x0200 + 180;
        }
        else if ( var207 < 900 )
        {
            var208 = 0x0200 + 181;
        }
        else 
        {
            var208 = 0x0200 + 182;
        }

    }

    int var211 = 768 + 65;
    int var212 = FUNCTION_0052( var211 );
    OPEN_MSG_WIN();
    int var213 = 0;
    
    if ( var212 > 0 )
    {
        SET_MSG_VAR( 0, var212, 0 );
        MSG( USE_KEY_OK );
        SET_SEL_CHOICE_KEYBIND( 14, 1 );
        var213 = SEL( YESNO_SEL );
        CLOSE_MSG_WIN();
        
        if ( var213 == 0 )
        {
            var212 = var212 - 1;
            FUNCTION_0053( var211, var212 );
            itembox_open_anim();
            OPEN_MSG_WIN();
            MSG( TRAPBOX_ENCOUNT );
            CLOSE_MSG_WIN();
            NS_WAIT( 10 );
            var210 = CALL_BATTLE( var205, 0 );
            
            if ( var210 != 0 )
            {
                
                if ( var210 == 1 )
                {
                    gVar9 = 0;
                    dng_decease_2();
                }

                return;
            }

            int var209 = FUNCTION_0052( var208 ) + 1;
            FUNCTION_0053( var208, var209 );
            SET_MSG_VAR( 0, var208, 1 );
            SET_MSG_VAR( 1, 1, 0 );
            OPEN_MSG_WIN();
            MSG( GET_ITEM_MES );
            CLOSE_MSG_WIN();
        }

    }
    else 
    {
        MSG( LOCK_BOX );
    }

    CLOSE_MSG_WIN();
}


void box_open_010_1()
{
    sVar0 = 0;
    sVar1 = 768 + 35;
    sVar2 = 3;
    int var214 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 619 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_010_2()
{
    sVar0 = 0;
    sVar1 = 768 + 22;
    sVar2 = 3;
    int var215 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 620 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_023_1()
{
    sVar0 = 0;
    sVar1 = 768 + 22;
    sVar2 = 3;
    int var216 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 644 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_023_2()
{
    sVar0 = 0;
    sVar1 = 768 + 6;
    sVar2 = 3;
    int var217 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 645 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_067()
{
    sVar0 = 0;
    sVar1 = 0x0400 + 54;
    sVar2 = 1;
    int var218 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 708 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_084()
{
    sVar0 = 0;
    sVar1 = 0x0400 + 53;
    sVar2 = 1;
    int var219 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 738 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_086()
{
    sVar0 = 0;
    sVar1 = 0x0400 + 52;
    sVar2 = 1;
    int var220 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 737 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_161_1()
{
    sVar0 = 0;
    sVar1 = 768 + 168;
    sVar2 = 1;
    int var221 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 848 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_161_2()
{
    sVar0 = 0;
    sVar1 = 0x0200 + 176;
    sVar2 = 1;
    int var222 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 849 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_161_3()
{
    sVar0 = 0;
    sVar1 = 768 + 163;
    sVar2 = 1;
    int var223 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 850 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void box_open_161_4()
{
    sVar0 = 0;
    sVar1 = 768 + 117;
    sVar2 = 1;
    int var224 = FUNCTION_0052( sVar1 ) + sVar2;
    BIT_ON( 0 + 0x0400 + 0x0800 + 851 );
    itembox_open_anim();
    death_check();
    itembox_open();
}


void set_pc_pos()
{
    FLD_FUNCTION_000C( FLD_FUNCTION_0004( 0 ), sVar7 );
    
    if ( GET_PARTY_MEMBER_ID( 0 ) != 0 )
    {
        FLD_FUNCTION_000C( FLD_FUNCTION_0004( 1 ), sVar8 );
    }

    
    if ( GET_PARTY_MEMBER_ID( 1 ) != 0 )
    {
        FLD_FUNCTION_000C( FLD_FUNCTION_0004( 2 ), var9 );
    }

    
    if ( GET_PARTY_MEMBER_ID( 2 ) != 0 )
    {
        FLD_FUNCTION_000C( FLD_FUNCTION_0004( 3 ), sVar10 );
    }

    FLD_FUNCTION_0017( 0, 1 );
    NS_WAIT( 30 );
    FUNCTION_0015( 30 );
    FADE_SYNC();
}


void change_speaker()
{
    CLOSE_MSG_WIN();
    OPEN_MSG_WIN();
}


void eve_dressroom_chie()
{
    FUNCTION_0077();
    CALL_EVENT( 172, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 513 );
    AI_FUNCTION_00DC( 513 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 173, 1, 0 );
    CALL_EVENT( 174, 1, 0 );
    BIT_ON( 0 + 49 );
    EVT_FUNCTION_0001( 1 );
}


void eve_dressroom_yukiko()
{
    BIT_ON( 0 + 0x20 );
    CALL_EVENT( 177, 1, 0 );
    CALL_DUNGEON( 7, 2 );
}


void eve_danceroom_yukiko()
{
    BIT_ON( 0 + 17 );
    BIT_OFF( 0 + 190 );
    FUNCTION_0077();
    CALL_EVENT( 178, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 514 );
    AI_FUNCTION_00DC( 514 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 179, 1, 0 );
    CALL_EVENT( 180, 1, 0 );
    FUNCTION_0096( 1, 0 );
}


void eve_sauna_entrance()
{
    BIT_ON( 0 + 2 );
    CALL_EVENT( 211, 1, 0 );
    CALL_DUNGEON( 20, 0 );
}


void eve_sauna_half()
{
    BIT_ON( 0 + 33 );
    CALL_EVENT( 212, 1, 0 );
    CALL_DUNGEON( 23, 0 );
}


void eve_sauna_bossroom()
{
    BIT_ON( 0 + 18 );
    BIT_OFF( 0 + 188 );
    FUNCTION_0077();
    CALL_EVENT( 213, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 515 );
    AI_FUNCTION_00DC( 515 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 214, 1, 0 );
    CALL_EVENT( 215, 1, 0 );
    FUNCTION_0096( 2, 0 );
}


void eve_strip_entrance()
{
    BIT_ON( 0 + 3 );
    CALL_EVENT( 247, 1, 0 );
    CALL_DUNGEON( 40, 0 );
}


void eve_strip_half()
{
    BIT_ON( 0 + 34 );
    CALL_EVENT( 248, 1, 0 );
    CALL_DUNGEON( 43, 0 );
}


void eve_strip_bossroom()
{
    BIT_ON( 0 + 19 );
    BIT_OFF( 0 + 186 );
    FUNCTION_0077();
    CALL_EVENT( 249, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 516 );
    AI_FUNCTION_00DC( 516 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 250, 1, 0 );
    CALL_EVENT( 251, 1, 0 );
    BIT_ON( 0 + 56 );
    FUNCTION_003A();
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 517 );
    AI_FUNCTION_00DC( 517 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 252, 1, 0 );
    CALL_EVENT( 253, 1, 0 );
    FUNCTION_0096( 3, 0 );
    INCREASE_SL( 24 );
}


void eve_gameworld_bossroom()
{
    BIT_ON( 0 + 20 );
    BIT_OFF( 0 + 184 );
    FUNCTION_0077();
    CALL_EVENT( 277, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 518 );
    AI_FUNCTION_00DC( 518 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 278, 1, 0 );
    CALL_EVENT( 279, 1, 0 );
    FUNCTION_0096( 4, 0 );
    CALL_EVENT( 280, 1, 0 );
    CALL_EVENT( 281, 1, 0 );
}


void eve_secretbase_entrance()
{
    BIT_ON( 0 + 5 );
    CALL_EVENT( 305, 1, 0 );
    CALL_DUNGEON( 80, 0 );
}


void eve_secretbase_bossroom()
{
    BIT_ON( 0 + 21 );
    BIT_OFF( 0 + 182 );
    FUNCTION_0077();
    CALL_EVENT( 306, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 519 );
    AI_FUNCTION_00DC( 519 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 307, 1, 0 );
    CALL_EVENT( 308, 1, 0 );
    FUNCTION_0096( 5, 0 );
}


void eve_heaven_first()
{
    CALL_EVENT( 353, 1, 0 );
}


void eve_heaven_entrance()
{
    BIT_ON( 0 + 6 );
    CALL_EVENT( 354, 1, 0 );
}


void eve_heaven_half()
{
    BIT_ON( 0 + 41 );
    CALL_EVENT( 355, 1, 0 );
    CALL_DUNGEON( 104, 0 );
}


void eve_heaven_bossroom()
{
    BIT_ON( 0 + 22 );
    BIT_OFF( 0 + 180 );
    CALL_EVENT( 356, 1, 0 );
    PLAY_CUTSCENE( 11 );
    FUNCTION_0065();
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 520 );
    AI_FUNCTION_00DC( 520 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 357, 1, 0 );
    FUNCTION_0096( 6, 0 );
}


void eve_last_bossroom()
{
    BIT_ON( 0 + 23 );
    FUNCTION_0077();
    CALL_EVENT( 418, 1, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 521 );
    AI_FUNCTION_00DC( 521 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 419, 1, 0 );
    PLAY_CUTSCENE( 14 );
    FUNCTION_0065();
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 522 );
    AI_FUNCTION_00DC( 522 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    
    if ( BIT_CHK( 0 + 0x0400 + 1045 ) == 1 )
    {
        EVT_FUNCTION_004B();
        INCREASE_SL( 0x20 );
    }

    CALL_EVENT( 420, 1, 0 );
    INCREASE_SL( 30 );
    FUNCTION_006B( 0 );
    CALL_EVENT( 421, 1, 0 );
    FUNCTION_0096( 7, 0 );
    BIT_ON( 0 + 0x0400 + 574 );
    BIT_OFF( 0 + 0x0400 + 1367 );
    
    if ( DATE_CHK( 12, 23 ) || DATE_CHK( 12, 24 ) )
    {
        BIT_OFF( 0 + 0x0400 + 1367 );
    }
    else if ( BIT_CHK( 0 + 0x0400 + 34 ) || BIT_CHK( 0 + 0x0400 + 36 ) || BIT_CHK( 0 + 0x0400 + 42 ) || BIT_CHK( 0 + 0x0400 + 45 ) || BIT_CHK( 0 + 0x0400 + 56 ) || BIT_CHK( 0 + 0x0400 + 58 ) || BIT_CHK( 0 + 0x0400 + 534 ) || BIT_CHK( 0 + 0x0400 + 38 ) && BIT_CHK( 0 + 0x0400 + 41 ) )
    {
        BIT_ON( 0 + 0x0400 + 1367 );
    }

    
    if ( DATE_CHK( 12, 22 ) && BIT_CHK( 0 + 0x0400 + 1367 ) || DATE_CHK( 12, 23 ) && BIT_CHK( 0 + 0x0400 + 1367 ) || DATE_CHK( 12, 24 ) )
    {
        BIT_OFF( 0 + 0x0400 + 574 );
    }

    BIT_OFF( 0 + 138 );
    CALL_EVENT( 422, 1, 0 );
    INCREASE_SL( 30 );
    BIT_ON( 0 + 693 );
    FUNCTION_006B( -1 );
}


void eve_extra_velvetroom()
{
    SHOW_DATE( 0 );
    CALL_EVENT( 432, 1, 0 );
    SHOW_DATE( 1 );
}


void eve_extra_bossroom()
{
    CALL_EVENT( 433, 1, 0 );
    PLAY_CUTSCENE( 15 );
    FUNCTION_0065();
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 523 );
    AI_FUNCTION_00DC( 523 );
    AI_FUNCTION_00DD();
    CALL_EVENT( 440, 1, 0 );
    int var225 = 2;
    _604:
    
    if ( var225 < 9 )
    {
        FUNCTION_0039( var225 );
        var225 = var225 + 1;
        goto _604;
    }

    FUNCTION_003A();
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 533 );
    AI_FUNCTION_00DC( 533 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 434, 1, 0 );
    SHOW_DATE( 0 );
    CALL_EVENT( 435, 1, 0 );
    SHOW_DATE( 1 );
    PLAY_CUTSCENE( 0x10 );
    FUNCTION_0065();
    BIT_ON( 0 + 47 );
    SHOW_DATE( 0 );
    CALL_EVENT( 465, 4, 0 );
    FADE_SYNC();
    SHOW_DATE( 1 );
    FUNCTION_0096( 9, 0 );
}


void eve_marie_entrance()
{
    BIT_ON( 0 + 0x0400 + 0x0800 + 0x0400 + 0x0200 + 0x0200 + 0x0200 + 0x20 );
}


void eve_marie_half()
{
    BIT_ON( 0 + 0x0400 + 0x0800 + 0x0400 + 0x0200 + 0x0200 + 0x0200 + 34 );
    CALL_EVENT( 455, 505, 0 );
}


void eve_marie_bossroom()
{
    CALL_EVENT( 455, 506, 0 );
    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 535 );
    AI_FUNCTION_00DC( 535 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    CALL_EVENT( 455, 507, 0 );
    int var228 = FUNCTION_005F( 1 );
    FUNCTION_0060( 1, var228 );
    int var227 = 0;
    _606:
    int var226 = 0;
    
    if ( var227 < 3 )
    {
        var226 = GET_PARTY_MEMBER_ID( var227 );
        
        if ( var226 != 0 )
        {
            
            if ( var226 == 2 )
            {
                var228 = FUNCTION_005F( 2 );
            }
            else if ( var226 == 3 )
            {
                var228 = FUNCTION_005F( 3 );
            }
            else if ( var226 == 4 )
            {
                var228 = FUNCTION_005F( 4 );
            }
            else if ( var226 == 6 )
            {
                var228 = FUNCTION_005F( 6 );
            }
            else if ( var226 == 7 )
            {
                var228 = FUNCTION_005F( 7 );
            }
            else if ( var226 == 8 )
            {
                var228 = FUNCTION_005F( 8 );
            }

            FUNCTION_0060( var226, var228 );
        }

        var227 = var227 + 1;
        goto _606;
    }

    SHOW_DATE( 0 );
    FUNCTION_0023( 3, 0 );
    AI_FUNCTION_00DE();
    AI_FUNCTION_00DF();
    SET_CNT( 34, 534 );
    AI_FUNCTION_00DC( 534 );
    AI_FUNCTION_00DD();
    SHOW_DATE( 1 );
    BIT_ON( 0 + 0x0400 + 0x0800 + 0x0400 + 0x0200 + 0x0200 + 0x0200 + 33 );
    CALL_EVENT( 455, 501, 0 );
    FUNCTION_006B( 0 );
    CALL_EVENT( 455, 502, 0 );
    FUNCTION_0096( 8, 0 );
    BIT_ON( 0 + 0x0400 + 0x0800 + 164 );
    CALL_EVENT( 455, 503, 0 );
    FUNCTION_006B( -1 );
    BIT_OFF( 0 + 0x0400 + 0x0800 + 164 );
}


void get_reach_level()
{
    int var231 = GET_FLOOR_ID();
    int var232 = var231 + 1;
    int var233 = 0;
    int var234 = 0;
    
    if ( var231 >= 160 && var231 <= 179 )
    {
        var233 = 35;
        var234 = 36;
    }
    else 
    {
        var233 = 9;
        var234 = 10;
    }

    int var229 = GET_CNT( var233 );
    int var230 = GET_CNT( var234 );
    
    if ( var231 >= var229 )
    {
        SET_CNT( var233, var232 );
    }

    
    if ( var231 >= var230 )
    {
        SET_CNT( var234, var232 );
    }

}


void common_floor_change()
{
    RESET_FLOOR();
    
    if ( GET_CNT( 38 ) == 13 )
    {
        SET_CNT( 38, 14 );
        BIT_OFF( 0 + 0x0400 + 0x0800 + 46 );
        BIT_OFF( 0 + 0x0400 + 0x0800 + 47 );
    }

}


void goto_stair()
{
    int var235 = GET_FLOOR_ID();
    common_floor_change();
    get_reach_level();
    int var236 = 0;
    
    if ( var235 >= 20 && var235 < 40 )
    {
        var236 = 27;
    }
    else if ( var235 >= 40 && var235 < 60 || var235 >= 100 && var235 < 120 && BIT_CHK( 0 + 0x0400 + 0x0800 + 95 ) == 0 )
    {
        var236 = 25;
    }
    else if ( var235 >= 80 && var235 < 100 )
    {
        var236 = 26;
    }
    else if ( var235 >= 120 && var235 < 140 && BIT_CHK( 0 + 0x0400 + 0x0800 + 95 ) == 0 )
    {
        var236 = 0;
        PLAY_SOUNDEFFECT( 705 );
    }
    else 
    {
        var236 = 24;
    }

    BIT_OFF( 0 + 0x0400 + 0x0800 + 95 );
    
    if ( var236 != 0 )
    {
        FUNCTION_0023( 1, var236 );
    }

    FADE( 1, 10 );
    FADE_SYNC();
    
    if ( var235 == 6 || var235 == 12 || var235 == 30 || var235 == 50 || var235 == 69 || var235 == 88 || var235 == 109 || var235 == 121 || var235 == 148 || var235 == 169 )
    {
        CALL_DUNGEON( var235 + 1, 0 );
    }
    else if ( var235 == 122 )
    {
        CALL_DUNGEON( 129, 0 );
    }
    else 
    {
        GOTO_REL_FLOOR( 1 );
    }

}


void backto_stair()
{
    int var238 = GET_FLOOR_ID();
    common_floor_change();
    int var239 = 0;
    
    if ( var238 >= 20 && var238 < 40 )
    {
        var239 = 27;
    }
    else if ( var238 >= 40 && var238 < 60 || var238 >= 100 && var238 < 120 && BIT_CHK( 0 + 0x0400 + 0x0800 + 95 ) == 0 )
    {
        var239 = 25;
    }
    else if ( var238 >= 80 && var238 < 100 )
    {
        var239 = 26;
    }
    else if ( var238 >= 120 && var238 < 140 && BIT_CHK( 0 + 0x0400 + 0x0800 + 95 ) == 0 )
    {
        var239 = 0;
        PLAY_SOUNDEFFECT( 705 );
    }
    else 
    {
        var239 = 24;
    }

    BIT_OFF( 0 + 0x0400 + 0x0800 + 95 );
    
    if ( var239 != 0 )
    {
        FUNCTION_0023( 1, var239 );
    }

    FADE( 1, 10 );
    FADE_SYNC();
    
    if ( var238 == 6 || var238 == 8 || var238 == 21 || var238 == 41 || var238 == 61 || var238 == 81 || var238 == 101 || var238 == 121 || var238 == 141 || var238 == 161 )
    {
        CALL_DUNGEON( var238 - 1, 1 );
    }
    else if ( var238 == 123 )
    {
        
        if ( GET_CNT( 29 ) <= var238 )
        {
            SET_CNT( 29, var238 );
        }

        CALL_DUNGEON( 120, 1 );
    }
    else 
    {
        GOTO_REL_FLOOR( -1 );
    }

}

